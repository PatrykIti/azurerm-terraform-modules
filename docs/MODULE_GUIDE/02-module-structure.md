# 2. Module Structure

A consistent directory structure is essential for maintainability and ease of use. Every new module MUST adhere to the structure outlined below. This structure is based on the `azurerm_kubernetes_cluster` module, which serves as the gold standard. If a specific service requires deviations, document the rationale in the module documentation. Use `azurerm_` for AzureRM modules and `azuredevops_` for Azure DevOps modules.

## Standard Directory Layout

```
modules/<provider>_<resource_name>/
├─── docs/
│    └─── IMPORT.md
├─── examples/
│    ├─── basic/
│    │    ├─── .terraform-docs.yml
│    │    ├─── main.tf
│    │    ├─── outputs.tf
│    │    ├─── variables.tf
│    │    └─── README.md
│    ├─── complete/
│    │    └─── ...
│    ├─── secure/
│    │    └─── ...
│    └─── <feature-specific>/ (optional)
│         └─── ...
├─── tests/
│    ├─── fixtures/
│    │    ├─── basic/
│    │    ├─── complete/
│    │    ├─── secure/
│    │    ├─── network/
│    │    ├─── negative/
│    │    └─── <feature-specific>/ (optional)
│    ├─── unit/
│    │    ├─── defaults.tftest.hcl
│    │    ├─── naming.tftest.hcl
│    │    ├─── validation.tftest.hcl
│    │    └─── outputs.tftest.hcl
│    ├─── .gitignore
│    ├─── go.mod
│    ├─── go.sum
│    ├─── <module>_test.go
│    ├─── integration_test.go
│    ├─── performance_test.go
│    ├─── test_helpers.go
│    ├─── test_config.yaml
│    ├─── test_env.sh
│    ├─── run_tests_parallel.sh
│    ├─── run_tests_sequential.sh
│    ├─── test_outputs/
│    └─── Makefile
├─── .releaserc.js
├─── .terraform-docs.yml
├─── CHANGELOG.md
├─── CONTRIBUTING.md
├─── generate-docs.sh
├─── main.tf
├─── Makefile
├─── module.json
├─── outputs.tf
├─── README.md
├─── SECURITY.md
├─── variables.tf
├─── VERSIONING.md
└─── versions.tf
```

## Key Components Explained

- **`docs/`**: Contains supplementary documentation. The standard is `IMPORT.md` (Terraform import blocks), aligned with the AKS module.
- **`examples/`**: Contains practical, runnable examples for different use cases. Each example should have its own `README.md` and `.terraform-docs.yml`. Feature-specific examples are optional (e.g., `diagnostic-settings`, `multi-node-pool`, `workload-identity`).
- **`tests/`**: Contains all tests for the module.
  - **`fixtures/`**: Terraform code for different test scenarios used by Terratest.
  - **`unit/`**: Native Terraform tests (`.tftest.hcl`) for fast, resource-independent validation.
  - **`go.mod`, `go.sum`**: Go module files for Terratest dependencies.
  - **`*_test.go`**: Go files containing the Terratest logic.
  - **`Makefile`**: Helper for running tests locally.
- **`.releaserc.js`**: Configuration for `semantic-release`.
- **`.terraform-docs.yml`**: Configuration for `terraform-docs` to auto-generate the `README.md`.
- **`CHANGELOG.md`**: Automatically generated by the release process.
- **`CONTRIBUTING.md`**: Guidelines for contributing to this specific module.
- **`generate-docs.sh`**: A script to simplify documentation generation.
- **`main.tf`**: The core logic of the module.
- **`Makefile`**: A top-level Makefile for common tasks like testing and documentation.
- **`module.json`**: A metadata file containing the module's name, scope, and description, used by automation scripts.
- **`outputs.tf`**: Declares the outputs of the module.
- **`README.md`**: The main documentation file, largely auto-generated.
- **`SECURITY.md`**: A document detailing the security features and considerations of the module.
- **`variables.tf`**: Declares the input variables for the module.
- **`VERSIONING.md`**: A document explaining the versioning strategy for the module.
- **`versions.tf`**: Specifies required Terraform and provider versions.
